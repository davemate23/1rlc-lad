{"changed":true,"filter":false,"title":"employee.rb","tooltip":"/app/models/employee.rb","value":"class Employee < ActiveRecord::Base\n  attr_accessor :remember_token, :activation_token\n  before_save   :downcase_email\n  before_create :create_activation_digest\n\tvalidates :last_name, \t\tpresence: true\n\tvalidates :service_no, \t\tpresence: true, \n\t\t\t\t\t\t\t\tlength: { minimum: 5 },\n\t\t\t\t\t\t\t\tlength: { maximum: 8 },\n\t\t\t\t\t\t\t\tformat: { with: /\\A^\\d+$\\z/ },\n\t\t\t\t\t\t\t\tuniqueness: true\n\tvalidates :date_of_birth, \tpresence: \n\tVALID_EMAIL_REGEX = /\\A[\\w+\\-.]+@[a-z\\d\\-.]+\\.[a-z]+\\z/i\n  validates :email, presence: true, length: { maximum: 255 },\n                    format: { with: VALID_EMAIL_REGEX },\n                    uniqueness: { case_sensitive: false }\n\tvalidates :gender, \t\t\tpresence: true\n\tvalidates :service_start_date, presence: true\n\tvalidates :substantive_rank, presence: true\n\tvalidates :password, length: { minimum: 6 }, allow_blank: true\n\thas_many :competencies\n\thas_one :spouse\n\thas_many :next_of_kins\n\thas_many :phones\n\thas_many :qualifications\n\thas_many :addresses\n\t\t\n\thas_secure_password\n\t\n\t  # This method associates the attribute \":avatar\" with a file attachment\n  has_attached_file :avatar, styles: {\n    thumb: '100x100>',\n    square: '200x200#',\n    medium: '300x300>'\n  }\n\n  # Validate the attached image is image/jpg, image/png, etc\n  validates_attachment_content_type :avatar, :content_type => /\\Aimage\\/.*\\Z/\n  \n   # Returns the hash digest of the given string.\n  def Employee.digest(string)\n    cost = ActiveModel::SecurePassword.min_cost ? BCrypt::Engine::MIN_COST :\n                                                  BCrypt::Engine.cost\n    BCrypt::Password.create(string, cost: cost)\n  end\n\t\n\t  # Returns a random token.\n  def Employee.new_token\n    SecureRandom.urlsafe_base64\n  end\n  \n  def remember\n    self.remember_token = Employee.new_token\n    update_attribute(:remember_digest, Employee.digest(remember_token))\n  end\n  \n    # Returns true if the given token matches the digest.\n  def authenticated?(attribute, token)\n    digest = send(\"#{attribute}_digest\")\n    return false if digest.nil?\n    BCrypt::Password.new(digest).is_password?(token)\n  end\n  \n    # Forgets a user.\n  def forget\n    update_attribute(:remember_digest, nil)\n  end\n  \n  def activate\n    update_attribute(:activated,    true)\n    update_attribute(:activated_at, Time.zone.now)\n  end\n  \n  # Sends activation email.\n  def send_activation_email\n    EmployeeMailer.account_activation(self).deliver_now\n  end\n  \n  # Sends password reset email.\n  def send_password_reset_email\n    EmployeeMailer.password_reset(self).deliver_now\n  end\n  \n   # Sets the password reset attributes.\n  def create_reset_digest\n    self.reset_token = Employee.new_token\n    update_attribute(:reset_digest,  User.digest(reset_token))\n    update_attribute(:reset_sent_at, Time.zone.now)\n  end\n  \n  # Returns true if a password reset has expired.\n  def password_reset_expired?\n    reset_sent_at < 2.hours.ago\n  end\n  \n  def age\n     x = Date.today.year - date_of_birth.year\n     x -= 1 if Date.today < date_of_birth + x.years #for days before birthday\n  end\n  \n  def years_of_service\n    Date.today.year - service_start_date.year\n  end\n  \n  def full_name\n  \n  private\n  \n  \n    # Converts email to all lower-case.\n    def downcase_email\n      self.email = email.downcase\n    end\n    \n    # Creates and assigns the activation token and digest.\n    def create_activation_digest\n      self.activation_token  = Employee.new_token\n      self.activation_digest = Employee.digest(activation_token)\n    end\nend\n","undoManager":{"mark":77,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":95,"column":31},"end":{"row":95,"column":32},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":32},"end":{"row":95,"column":33},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":29},"end":{"row":95,"column":33},"action":"remove","lines":["date"]},{"start":{"row":95,"column":29},"end":{"row":95,"column":42},"action":"insert","lines":["date_of_birth"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":47},"end":{"row":96,"column":0},"action":"insert","lines":["",""]},{"start":{"row":96,"column":0},"end":{"row":96,"column":5},"action":"insert","lines":["     "]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":76},"action":"insert","lines":["age -= 1 if Date.today < birthday + age.years #for days before birthday"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":37},"end":{"row":96,"column":38},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":36},"end":{"row":96,"column":37},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":35},"end":{"row":96,"column":36},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":34},"end":{"row":96,"column":35},"action":"remove","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":33},"end":{"row":96,"column":34},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":32},"end":{"row":96,"column":33},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":31},"end":{"row":96,"column":32},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":30},"end":{"row":96,"column":31},"action":"remove","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":30},"end":{"row":96,"column":31},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":31},"end":{"row":96,"column":32},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":32},"end":{"row":96,"column":33},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":33},"end":{"row":96,"column":34},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":30},"end":{"row":96,"column":34},"action":"remove","lines":["date"]},{"start":{"row":96,"column":30},"end":{"row":96,"column":43},"action":"insert","lines":["date_of_birth"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":9},"end":{"row":96,"column":10},"action":"remove","lines":["-"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":9},"end":{"row":96,"column":10},"action":"insert","lines":["-"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":22},"end":{"row":100,"column":23},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":21},"end":{"row":100,"column":22},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":20},"end":{"row":100,"column":21},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":19},"end":{"row":100,"column":20},"action":"remove","lines":["e"]},{"start":{"row":100,"column":18},"end":{"row":100,"column":19},"action":"remove","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":17},"end":{"row":100,"column":18},"action":"remove","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":16},"end":{"row":100,"column":17},"action":"remove","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":15},"end":{"row":100,"column":16},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":14},"end":{"row":100,"column":15},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":13},"end":{"row":100,"column":14},"action":"remove","lines":["s"]},{"start":{"row":100,"column":12},"end":{"row":100,"column":13},"action":"remove","lines":["_"]},{"start":{"row":100,"column":11},"end":{"row":100,"column":12},"action":"remove","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":10},"end":{"row":100,"column":11},"action":"remove","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":9},"end":{"row":100,"column":10},"action":"remove","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":8},"end":{"row":100,"column":9},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":7},"end":{"row":100,"column":8},"action":"remove","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":6},"end":{"row":100,"column":7},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":5},"end":{"row":100,"column":6},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":100,"column":4},"end":{"row":100,"column":5},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":10},"end":{"row":95,"column":11},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":9},"end":{"row":95,"column":10},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":8},"end":{"row":95,"column":9},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":7},"end":{"row":95,"column":8},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":6},"end":{"row":95,"column":7},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":5},"end":{"row":95,"column":6},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":5},"end":{"row":95,"column":6},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":6},"end":{"row":95,"column":7},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":6},"end":{"row":95,"column":7},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":95,"column":8},"end":{"row":95,"column":9},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":50},"end":{"row":96,"column":51},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":49},"end":{"row":96,"column":50},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":48},"end":{"row":96,"column":49},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":48},"end":{"row":96,"column":49},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":7},"end":{"row":96,"column":8},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":6},"end":{"row":96,"column":7},"action":"remove","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":96,"column":5},"end":{"row":96,"column":6},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":101,"column":5},"end":{"row":102,"column":0},"action":"insert","lines":["",""]},{"start":{"row":102,"column":0},"end":{"row":102,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":102,"column":2},"end":{"row":103,"column":0},"action":"insert","lines":["",""]},{"start":{"row":103,"column":0},"end":{"row":103,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":2},"end":{"row":103,"column":3},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":3},"end":{"row":103,"column":4},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":4},"end":{"row":103,"column":5},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":5},"end":{"row":103,"column":6},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":6},"end":{"row":103,"column":7},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":7},"end":{"row":103,"column":8},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":8},"end":{"row":103,"column":9},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":9},"end":{"row":103,"column":10},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":10},"end":{"row":103,"column":11},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":10},"end":{"row":103,"column":11},"action":"remove","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":10},"end":{"row":103,"column":11},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":11},"end":{"row":103,"column":12},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":12},"end":{"row":103,"column":13},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":13},"end":{"row":103,"column":14},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":13},"end":{"row":103,"column":14},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":12},"end":{"row":103,"column":13},"action":"remove","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":11},"end":{"row":103,"column":12},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":11},"end":{"row":103,"column":12},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":12},"end":{"row":103,"column":13},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":13},"end":{"row":103,"column":14},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":103,"column":14},"end":{"row":103,"column":15},"action":"insert","lines":["e"]}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":103,"column":15},"end":{"row":103,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1421536334596}